units:
  # Key and keycap measures
  kx: u # spacing between key centers (X-axis)
  ky: u # spacing between key centers (Y-axis)
  kp: 19 # padding (default: 19)
  ks: 19 # spread (deafult: 19)
  kcow: 14 # key cutout hole width (cherry: 14, choc: 13.8)
  kcoh: 14 # key cutout hole height (cherry: 14, choc: 13.8)
  keycw: 18 # keycap width (cherry: 18, choc: 17.5)
  keych: 18 # keycap height (cherry: 18, choc: 16.5)
  led_pos_x: 0 # Led X position relative to the switch center
  led_pos_y: 4.75 # Led Y position relative to the switch center
  led_rotation: 0 # Led rotation
  vertical_underglow_shift: 0.5 kp # How much to shift underglow leds tied to keys
  switch_rotation: 180 # 0 = Hotswap south, led north

  # Physical measures
  screw_radius: 1.1 # M2 screws
  spacer_radius: 2.05 # M2 standoffs
  fillet_radius: 1
  pcb_tolerance: 0.5 # How much to expand the PCB on a single side
  frame_dimension: 4 # The size of the stacked acrylic frame

points:
  zones:
    matrix:
      key:
        tags:
          - key
      anchor:
        shift: [160, -175]
        rotate: 0
      rotate: 6.5
      rows:
        bottom:
          row_net:
        home:
          row_net:
        top:
          row_net:
      columns:
        pinkie:
          key.stagger: -0.5ky
        ring:
          key.splay: -4
          key.stagger: 7
          key.spread: kx
        middle:
          key.splay: -2
          key.stagger: 5
          key.spread: kx+0.75
        index:
          key.stagger: -3
          key.splay: -2
          key.spread: kx+1
        inner:
          key.stagger: -5
          key.splay: -1
          key.spread: kx+0.6
    thumbs:
      key:
        tags:
          - key
      anchor:
        ref: matrix_middle_bottom
        shift: [0, -1U]
      rows.thumbs.row_net:
      columns:
        middle:
        inner:
          key.splay: -2
          key.stagger: -3
        outer:
          key.splay: -7
          key.shift: [1, -6]
        reach:
          key.splay: -3
          key.stagger: -8
          key.shift: [1.5, 1.5]
outlines:
  debug_points:
    - what: rectangle
      where: true
      size: [6, 0.01]
    - what: rectangle
      where: true
      size: [0.01, 4]
    - what: circle
      where: true
      radius: 0.4
      adjust:
        shift: [3, 0]
    - what: circle
      where: true
      radius: 0.4
      adjust:
        shift: [0, 2]
    - what: rectangle
      where: [key]
      size: [kx, ky]
      operation: stack
    - what: rectangle
      where: [key]
      size: [kcow, kcoh]
      operation: stack
    - what: circle
      where: [screw]
      radius: 2
      operation: stack
  _switch_cutouts:
    - what: rectangle
      where: [key]
      size: [kcow, kcoh]
  _base:
    - what: rectangle
      where: [key]
      size: [kp, kp]
    - what: polygon
      operation: add
      points:
        - ref: thumbs_reach_thumbs
          shift: [0.5kp, 0]
        - ref: matrix_inner_bottom
          shift: [0.2kp, -0.5kp]
        - ref: matrix_inner_bottom
          shift: [0.5kp, -kp]
    - what: polygon
      operation: add
      points:
        - ref: thumbs_outer_thumbs
          shift: [1.7kp, 0.35kp]
        - ref: matrix_inner_top
          shift: [1.4kp, 0.5kp]
        - ref: matrix_inner_top
          shift: [0, 0.5kp]
        - ref: thumbs_outer_thumbs
          shift: [0, 0.4kp]
  pcb:
    - what: outline
      name: _base
      expand: 2
      fillet: fillet_radius
  _pcb_tolerance:
    - what: outline
      name: pcb
      expand: pcb_tolerance * 2
  preview:
    - what: outline
      name: debug_points
    - what: rectangle
      where: [key]
      size: [keycw, keych]
      operation: stack
    - what: outline
      name: _switch_cutouts
      operation: stack
    - what: outline
      name: pcb
      operation: stack
pcbs:
  goose:
    outlines:
      main.outline: pcb
    footprints:
      switches:
        what: mx
        where: [key]
        params:
          keycaps: true
          reverse: true
          hotswap: false
          from: "{{column_net}}"
          to: "{{colrow}}"
        adjust:
          rotate: switch_rotation
      diode:
        what: custom/combo_diode
        where: [key]
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
          include_smd: true
          include_tht: false
          reversible: true
        adjust:
          shift: [0, 8]
          rotate: 0
      mcu:
        what: custom/xiao
        params:
          side: "F"
        where:
          ref: matrix_inner_top
          shift: [1kx, -(8)]
      #     rotate: -90
